= Таблица маршрутизации

У каждого узла, который подключен к глобальной сети Интернет должна быть своя таблица маршрутизации. Именно благодаря таблице маршрутизации хост может принимать решения, когда он сам может доставлять пакеты по сети, а когда ему нужно отправить пакет на маршрутизатор.

Вы можете посмотреть свою таблицу маршрутизации. Если у вас ОС Windows, то в командной строке наберите “route print”. Результатом работы команды будет вывод вашей текущий таблицы маршрутизации, подобно тому, как на рисунке ниже.

.Таблица маршрутизации под Windows.
image::{docdir}/images/route_table.png[Таблица маршрутизации под Windows.]

Так как у меня стоит много разных виртуальных интерфейсов, то таблица маршрутизации состоит из более чем 2-х записей. Но все они уже должны быть вам понятны.

Самая первая запись - сетевой адрес 0.0.0.0, маска подсети 0.0.0.0 и адрес шлюза 192.168.0.1. Это и есть маршрут по умолчанию. Но мы уже знаем, что хоть эта запись стоит и первой, просматривается она в последнюю очередь.

IP адрес моего сетевого интерфейса 192.168.0.107. И в таблице на 5 строке можно увидеть запись - сетевой адрес 192.168.0.0, маска подсети 255.255.255.0 и адрес шлюза 192.168.0.107 (т.е. я сам). Это маршрут до хостов в моей сети.

Метрика в таблице маршрутизации нужна для приоритета. Если в таблице будет два одинаковых маршрута, то метрика позволит выбрать более приоритетный. Чем ниже метрика, тем приоритетней маршрут. Например, для отказоустойчивости вы хотите сделать два маршрута по умолчанию. Чтобы всегда работал только один, а второй начал работать только при неработоспособности первого, можно воспользоваться метрикой.

А если у вас Linux или MacOS, наберите в терминале _netstat -nr_. Вот так выглядит таблица маршрутизации у моего Linux сервера.

.Таблица маршрутизации под Linux
image::{docdir}/images/route_table_linux.png[Таблица маршрутизации под Linux]

Как и в случае с Windows, на первом месте стоит маршрут по умолчанию - сеть назначения (Destination) 0.0.0.0 с маской (Genmask) 0.0.0.0 и маршрутизатором 10.129.0.1.

На рисунке 71 можно еще увидеть вывод команды ifconfig. Как видно, IP адрес у моего Linux сервера 10.129.0.21 с маской 255.255.255.0. и в таблице маршрутизации второй записью мы видим - сеть назначения 10.129.0.0 с маской 255.255.255.0 использовать маршрутизатор 0.0.0.0. Как можно сделать вывод, если в таблице маршрутизации Linux в поле маршрутизатор (Gateway) стоит 0.0.0.0, значит хост сам знает как общаться с этой сетью.

== Один сетевой сегмент и разные IP сети

Давайте рассмотрим еще один интересный пример. Сделаем сеть из 3-х хостов и 1 свитча. Два хоста будут находиться в одной IP сети, а третий в другой, как на рисунке.

.Два хоста в разных IP сетях. (https://miminet.ru/web_network?guid=adfb3817-4161-4c82-9578-1934e70f8a41).
image::{docdir}/images/1_segment_2_net.png[Два хоста в разных IP сетях. (https://miminet.ru/web_network?guid=adfb3817-4161-4c82-9578-1934e70f8a41).]

И так, сделаем сеть из 3 хостов объединенных одним свитчем:

* Хост 1 и хост 2 будут находиться в одной IP сети - 192.168.1.0/24
* А хост 3 настроим для другой IP сети - 192.168.0.0/24
* У хоста 1 будет IP адрес 192.168.1.1/24
* У хоста 2 - 192.168.1.2/24
* У хоста 3 - 192.168.0.3/24

Таблица маршрутизации для хоста 1 будет выглядеть как в таблице ниже.

[cols="1,1"]
|===
^|IP сеть назначения
^|IP адрес маршрутизатора

^|192.168.1.0/24
^|192.168.1.1
|===

Эта запись добавляется автоматически, как только мы сконфигурировали IP настройки для этого хоста. Во время настройки IP адреса и маски хоста автоматически добавляется подобная запись в таблицу маршрутизации. Раз наш хост из этой сети, значит он сам может общаться со всеми хостами в этой сети.

Если мы отправим ICMP-запрос на хост 2, то мы получим от него ICMP-ответ. Так как мы с ним одной сети и соединены свитчем. ICMP-запрос можно отправить командой ping и указав в качестве аргумента IP адрес. В нашем случае ping -c 1 192.168.1.2.

А теперь посмотрите на хост 3. Он хоть и подключен к тому же свитчу, что и хост 2, но его IP адрес лежит в другой IP сети. И получается, что на физическом и на канальном уровне мы можем обмениваться пакетами. А на сетевом уровне эти хосты друг про друга ничего не знают.

Чтобы хост 1 и 3 смогли обмениваться данными им нужно добавить в свою таблицу маршрутизации маршрут. Для хоста 1 это маршрут до сети 192.168.0.0/24, а для хоста 3 это маршрут до сети 192.168.1.0/24.

После добавления таких маршрутов хост 1 и хост 3 смогут обмениваться данными.