= UDP

UDP (User Datagram Protocol) - протокол передачи пользовательских датаграмм, описан в https://datatracker.ietf.org/doc/html/rfc768[RFC 768]. Это транспортный протокол и, соответственно располагается на транспортном уровне модели ISO/OSI.

.UDP протокол в модели OSI.
image::{docdir}/images/udp.png[UDP протокол в модели OSI.]

UDP обеспечивает передачу данных между приложениями, при этом, он не заботиться о надежности доставки данных. Во время передачи UDP пакет может потеряться или  придти в другом порядке. Более того. UDP пакет может даже не отправится с хоста, если буфер на отправку будет переполнен.

Может показаться, зачем тогда придумали UDP, раз он такой ненадежный? При всех этих недостатках UDP отлично решает задачи, для которых он был придуман:

* Передача трафика в реальном времени.
* Передача данных там, где скорость важней надежности.
* Передача группового трафика.

Если вы откроете https://datatracker.ietf.org/doc/html/rfc768[RFC 768], то увидите, что весь протокол описан на 3-х страницах, а сам UDP заголовок занимает всего 8 байт:

* Порт источника (2 байта)
* Порт назначения (2 байта)
* Размер передаваемых в пакете данных (2 байта)
* Контрольная сумма (2 байта)

.UDP заголовок.
image::{docdir}/images/udp_header.png[UDP заголовок.]

== Передача данных в реальном времени

UDP протокол отлично подходит для передачи данных в реальном времени. Например, когда идет видео-конференция или когда вы играете в многопользовательскую онлайн игру.

Представьте, вы играете в многопользовательскую онлайн-игру (CS, Dota2, StarCraft) и используете надежный протокол доставки данных, например, TCP. Если во время передачи данных потеряется пакет с данными о состоянии игры, то TCP попробует его восстановить, т.е. еще раз передать.

Мало того, что во время восстановления потерянного пакета у вас подвиснет игра, так еще и пришедшие данные будут уже неактуальны, ведь состояние сервера к этому моменту станет другим.

В то же время, если вы будете использовать UDP протокол, то потеря одного пакета привет только к легкому зависанию игры (или как говорят лаг). А последующие пришедшие пакеты будут содержать актуальное состояние игрового сервера.

Если мы это смоделируем на видеоконференцию, то по мере возникновения потерь и восстановлений пакетов, наблюдаемая видеоконференция будет отдаляться от реальной. Чем больше пакетов будет теряться и восстанавливаться, тем на большее время видеоконференция будет отставать от реальности.

== Скорость важней надежности

UDP протокол оказывается очень полезным, когда скорость передачи важней надежности.

Например, UDP протокол используется службой DNS. Эта служба занимается сопоставлением доменного имени к IP адресу. Каждый раз, когда вы в браузере вбиваете название сайта, например miminet.ru, ваш хост обращается к DNS серверу, чтобы узнать IP адрес сервера. Эти DNS запросы в качестве транспорта используют UDP протокол. Почему так? Потому что так эффективней! Давайте посчитаем:

. Например, хост делает 10 DNS запросов и получаете 10 DNS ответов, как итог, в сети будет 20 пакетов (10 запросов + 10 ответов).
. Предположим, что каждый 10-й запрос теряется. Итого, будет 21 пакет (11 запросов и 10 ответов).
. Если мы будем использовать TCP, только для одного DNS запроса в сети будет 9 пакетов. А 10 запросов приведет к появлению 90 пакетов (почему у TCP будет так много пакетов мы узнаем чуть позже, когда будем знакомиться с работой TCP, а пока просто поверьте).

Поэтому, в этом случае лучше эффективней использовать UDP.

Другим примером является протокол NTP - это протокол синхронизации времени с сервером времени. NTP так устроен, что требуется подсчитать примерное время доставки пакета от хоста к серверу и в обратную сторону.  В случае потери пакетов с данными лучше это определить самостоятельно, повторно засечь время и сделать повторную попытку. Если в этом случае использовать TCP протокол, то потеря пакета и его восстановление сильно повлияет на расчеты.

== Передача группового трафика

UDP единственный протокол транспортного уровня в стеке TCP/IP, который может использоваться для передач группового трафика.

Например, у вас есть целый компьютерный класс или новый офис с 50 одинаковыми компьютерами. И на все компьютеры вам нужно установить одинаковую ОС и одинаковое ПО. Как правило, такая задача решается следующим путем:

. На один из 50 компьютеров устанавливается все необходимое ПО.
. Затем, с помощью специальных утилит создается образ жесткого диска. Его размер может быть более десятков гигабайт.
. В конце, этот образ жесткого диска по сети загружается на остальные компьютеры. Этот процесс обычно называют “разливка образа”.

Так вот, финальный этап как раз и решается через мультикаст. Загружать по несколько десятков гигабайт на 50 компьютеров слишком долго. Проще это сделать через групповую рассылку. И в качестве протокола транспортного уровня используется UDP.

.Групповой трафик (мультикаст). (https://miminet.ru/web_network?guid=4fc0fafb-2a16-4244-a664-3f1e8f788a63).
image::{docdir}/images/udp_multicast.png[Групповой трафик (мультикаст). (https://miminet.ru/web_network?guid=4fc0fafb-2a16-4244-a664-3f1e8f788a63)]

== Выводы по UDP

Протокол UDP отлично подходит для передачи данных в реальном времени и для доставки данных при групповой рассылке.
